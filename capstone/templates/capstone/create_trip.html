{% extends "capstone/layout.html" %}

{% block body %}

    <script>

        function get_cities(state_id, place){
        fetch(`/get_cities/${state_id}`)
        .then(response => response.text())
        .then(data => {
            var info = document.getElementById(place);
            info.innerText = null
            new_data = data.split(',')
            new_data.pop()
            var opt_group = document.createElement('optgroup');
            opt_group.label = "City"
            info.appendChild(opt_group)
            for (let index = 0; index < new_data.length; index++) {
                var opt = document.createElement('option');
                opt.appendChild( document.createTextNode(new_data[index]));
                opt.value = new_data[index]; 
                opt_group.appendChild(opt);
            }
            $('.selectpicker').selectpicker('refresh');
        })
        
        };

        document.addEventListener('DOMContentLoaded', (event) => {
            date = new Date
            date_picker.min =  date.toISOString().split("T")[0];
            date_picker.max = new Date(date.setMonth(date.getMonth()+1)).toISOString().split("T")[0];
        });
    </script>


    {% if message %}
    <div class="alert alert-danger" role="alert">
        {{message}}
    </div>
    {% endif %}
    
    <h1>Create Trip</h1>

    <form id="form" action="{% url 'create_trip' %}" method="POST">
        {% csrf_token %}
        <div class="form-group">
            <h6>Origin</h6>
            <select id="o_state" name='o_state' class="selectpicker" data-live-search="true" onchange="get_cities(document.querySelector('#o_state').value, 'o_city')" required>
                <optgroup label="State">
                <option value="" selected disabled>Choose a State</option>
                {% for state in states %}
                <option id="o_state_option" value="{{state.id}}">{{state.state_name}}</option>
                {% endfor %}
                </optgroup>
            </select>
            <select id="o_city" name="o_city" class="selectpicker" data-live-search="true" required> 
                <option value="" disabled selected>Choose a City</option>
            </select>
        </div>
        <div class="form-group">
            <h6>Destination</h6>
            <select id="d_state" name="d_state" class="selectpicker" data-live-search="true" onchange="get_cities(document.querySelector('#d_state').value,'d_city')" required>
                <optgroup label="State">
                <option value="" selected disabled>Choose a State</option>
                {% for state in states %}
                <option id="d_state_option" value="{{state.id}}">{{state.state_name}}</option>
                {% endfor %}
                </optgroup>
            </select>
            <select id="d_city" name="d_city" class="selectpicker" data-live-search="true" required>
                <option value="" disabled selected>Choose a City</option>
            </select>
        </div>
        <div class="form-group">
                <label for="date">Date</label>
                <input id="date_picker" name="date_picker" class="form-control" type="date" required>
        </div>
        <div class="form-group">
            <label for="time_picker">Time</label>
            <input id="time_picker" name="time_picker" class="form-control" type="time" required>
        </div>
        <div class="form-group">
            <label for="est_time">Estimated Time</label>
            <input id="est_time" name="est_time" type="text" class="form-control" style="width: 220px;" placeholder="Example: 3:20" required>
        </div>
        <div class="form-group">
            <label for="car_size">Car Seats</label>
            <input id="car_size" name="car_size" type="number" class="form-control" style="width: 220px;" placeholder="Min: 2 Max: 20" required>
            <label for="seats">Available Seats</label>
            <input id="seats" name="seats" type="number" class="form-control" style="width: 220px;" placeholder="Min: 1 Max: 19" required>
        </div>
        <div class="form-group">
            <button class="btn btn-primary" type="submit">Submit form</button>
        </div>

    </form>


{% endblock %}